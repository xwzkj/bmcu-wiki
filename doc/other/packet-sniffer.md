# XMCU抓包工具

该工具适用于bambu-bus的485协议抓包工作

由`@丸子`与`@星尘`进行电路设计，由`@丸子`进行软件开发

## 快速开始

1. [打板PCB](https://oshwhub.com/xwzkj/xmcu-zhua-bao-gong-ju)
2. 焊接PCB
3. 烧录固件
4. 配网
5. 上传前端资源

## 物料清单

很多原件与BMCU用到的规格一致，可以使用BMCU剩下的原件

| 名称               | 数量 | 购买链接                                                                          | 需选择个数 | 备注                              |
| ------------------ | ---- | --------------------------------------------------------------------------------- | ---------- | --------------------------------- |
| ESP-12F模组        | 1    | [点此购买](https://item.taobao.com/item.htm?id=890149347133&skuId=5815621768599)  | 1          | 财力雄厚建议选择安信可出品        |
| SK12D07VG3拨杆开关 | 1    | [点此购买](https://item.taobao.com/item.htm?id=522579508313)                      | 1          | -                                 |
| 10Ω电阻 0603       | 2    | [点此购买](https://item.taobao.com/item.htm?id=525724626983)                      | 1          | -                                 |
| 120Ω电阻 0603      | 1    | [点此购买](https://item.taobao.com/item.htm?id=525735174372)                      | 1          | -                                 |
| PSM712             | 1    | [点此购买](https://item.taobao.com/item.htm?id=652999552289)                      | 1          | -                                 |
| 75176              | 1    | [点此购买](https://item.taobao.com/item.htm?id=654383182827)                      | 1          | -                                 |
| SMBJ24CA           | 1    | [点此购买](https://item.taobao.com/item.htm?id=565061951670)                      | 1          | -                                 |
| 100nF电容 0603     | 1    | [点此购买](https://item.taobao.com/item.htm?id=522573286298&skuId=5728018873000)  | 1          | -                                 |
| 2.54间距2*2排针    | 1    | [点此购买](https://item.taobao.com/item.htm?id=571157550340&skuId=4364789858233)  | 1          | 可以用其他规格的2.54排针拼凑成2*2 |
| MX3.0 2*2座        | 2    | [点此购买](https://detail.tmall.com/item.htm?id=624554633508&skuId=4592301798674) | 1          | -                                 |
| MX3.0 2*3座        | 2    | [点此购买](https://detail.tmall.com/item.htm?id=624554633508&skuId=4592301798679) | 1          | -                                 |
| 24v->3.3V 降压模块 | 1    | [点此购买](https://item.taobao.com/item.htm?id=644346322045&skuId=4634423556340)  | 1          | -                                 |
| LED 0603           | 1    | [点此购买](https://item.taobao.com/item.htm?id=522573309525)                      | 1          | 可选                              |
| 微动开关           | 2    | [点此购买](https://item.taobao.com/item.htm?id=546724645617&skuId=3950794532931)  | 1          | -                                 |
| 10kΩ排阻 0603*4    | 2    | [点此购买](https://item.taobao.com/item.htm?id=522573249593&skuId=5718679317165)  | 1          | -                                 |

**关于焊接辅助：** 请前往立创eda的`工具`->`焊接辅助工具`查看

## 固件烧录

前往下载中心的链接下载抓包工具的`固件bin文件`以及`ESP烧录工具`

使用CH340串口模块连接抓包工具和电脑，线序与BMCU一致

打开烧录工具，会弹出一个黑色命令行窗口，不要关闭

选择ESP8266，Develop模式，点击`OK`

![烧录工具-选择型号](/assets/other/packet-sniffer/烧录工具-选择型号.jpg)

按照下图设置：

1. 勾选复选框
2. 选择固件bin文件
3. 填写地址为`0x0`
4. 确认DoNotChgBin被勾选
5. 选择串口号 **如果不知道在哪里查看串口号，请查看BMCU的烧录教程**
6. 点击`START`，此时会显示`SYNC 同步`
7. 按住按键`B`，单击按键`R`，此时状态会变为`下载中`，便可放开按键`B`
8. 等待进度条跑满，显示成功后便可按下按键`R`重启
9. 烧录完毕

![烧录工具-选项](/assets/other/packet-sniffer/烧录工具-选项.jpg)

## 配网

若您的8266模组未连接过您的wifi，请连接AP信号：`xmcu抓包工具配网`，并按照弹出的网页进行配网。

## 前端资源上传

> 固件中带有mDNS和LLMNR服务，但windows对其的支持不佳，若无法通过域名访问，请前往路由器后台查看IP，并使用IP访问抓包工具。

尝试访问`http://xmcu.local`和`http://xmcu/`，因8266模组内未存储前端资源，会自动跳转到`/upload`页面

打开页面后，点击`格式化`按钮，并按照页面提示上传前端资源

![前端资源上传](/assets/other/packet-sniffer/前端资源上传.jpg)

弹窗提示`上传完成`、且中途没有报错提示，即可再次访问以上网址（访问根目录），即可打开抓包工具前端网页

![前端页面](/assets/other/packet-sniffer/前端页面.jpg)

::: tip
如后续需要升级前端资源，前往`/upload`页面重新进行这个章节的操作即可
:::

## 使用

在断电情况下，在MX3.0连接座上，一遍通过BMCU线序的连接线连接打印机，一边通过ams线缆连接ams（lite），开启打印机，即可使用。

::: warning
6pin连接座的线序未经过测试，请前往电路设计图自行确定线序
:::
